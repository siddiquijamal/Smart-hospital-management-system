<!DOCTYPE html>
<html>
<head>
  <title>Doctor Appointments</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container py-4">

  <h3 class="mb-3">My Appointments</h3>

  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-{{ m.tags }}">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <div class="card shadow">
    <div class="card-body">

      {% if appointments %}
      <table class="table table-bordered align-middle">
        <thead class="table-light">
          <tr>
            <th>Patient</th>
            <th>Date</th>
            <th>Time</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
        {% for a in appointments %}
          <tr>
            <td>{{ a.patient.fullname }}</td>
            <td>{{ a.date }}</td>
            <td>{{ a.time }}</td>

            <td>
              {% if a.status == "pending" %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% elif a.status == "approved" %}
                <span class="badge bg-success">Approved</span>
              {% else %}
                <span class="badge bg-danger">Rejected</span>
              {% endif %}
            </td>

            <td>
              {% if a.status == "pending" %}
              <div class="d-flex gap-2">

                <form method="post" action="{% url 'update_appointment_status' a.id %}">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="approved">
                  <button class="btn btn-success btn-sm">Approve</button>
                </form>

                <form method="post" action="{% url 'update_appointment_status' a.id %}">
                  {% csrf_token %}
                  <input type="hidden" name="action" value="rejected">
                  <input type="hidden" name="reason" value="Doctor unavailable">
                  <button class="btn btn-danger btn-sm">Reject</button>
                </form>

              </div>
              {% else %}
                <small class="text-muted">No action</small>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

      {% else %}
        <p class="text-center text-muted">No appointments yet</p>
      {% endif %}

    </div>
  </div>
</div>

</body>
</html>
